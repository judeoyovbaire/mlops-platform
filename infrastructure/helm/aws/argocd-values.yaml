# ArgoCD Helm Chart Values for AWS EKS

global:
  domain: argocd.mlops.local

# Server configuration
server:
  replicas: 1

  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/backend-protocol: HTTPS
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
      alb.ingress.kubernetes.io/certificate-arn: ""  # Add ACM cert ARN for production
    hosts:
      - argocd.mlops.local
    tls:
      - hosts:
          - argocd.mlops.local
        secretName: argocd-server-tls

  # TLS Configuration - ArgoCD handles TLS internally
  # For production: Use cert-manager with Let's Encrypt or ACM certificates
  extraArgs: []

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Controller configuration
controller:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Repo server configuration
repoServer:
  replicas: 1
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Redis configuration
redis:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

# ApplicationSet controller
applicationSet:
  enabled: true
  replicas: 1

# Notifications controller
notifications:
  enabled: false

# Resource customizations for KServe InferenceService
configs:
  cm:
    resource.customizations: |
      serving.kserve.io/InferenceService:
        health.lua: |
          hs = {}
          if obj.status ~= nil then
            if obj.status.conditions ~= nil then
              for i, condition in ipairs(obj.status.conditions) do
                if condition.type == "Ready" and condition.status == "True" then
                  hs.status = "Healthy"
                  hs.message = "InferenceService is ready"
                  return hs
                end
              end
            end
          end
          hs.status = "Progressing"
          hs.message = "Waiting for InferenceService to be ready"
          return hs
