# Argo Workflows values for ML pipeline orchestration
# Lightweight configuration without database persistence

# Controller configuration
controller:
  replicas: 1

  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Workflow defaults
  workflowDefaults:
    spec:
      # Default TTL for completed workflows
      ttlStrategy:
        secondsAfterCompletion: 86400   # 24 hours
        secondsAfterSuccess: 43200      # 12 hours
        secondsAfterFailure: 172800     # 48 hours

      # Pod garbage collection
      podGC:
        strategy: OnPodCompletion

  # Disable database persistence completely (use Kubernetes CRDs only)
  # Empty object = no persistence config = no database required
  persistence: {}

  # Metrics for Prometheus
  metricsConfig:
    enabled: true

# Server (UI) configuration
server:
  replicas: 1

  # Expose via ClusterIP (use port-forward or ingress)
  serviceType: ClusterIP

  # Auth mode - client for dev, sso for production
  authModes:
    - client

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Extra arguments
  extraArgs:
    - --auth-mode=client

# Artifact repository configuration
artifactRepository:
  # Use MinIO for S3-compatible artifact storage
  s3:
    endpoint: minio:9000
    bucket: mlpipeline
    insecure: true
    accessKeySecret:
      name: minio
      key: rootUser
    secretKeySecret:
      name: minio
      key: rootPassword

# Workflow templates
workflowTemplates:
  # Enable workflow templates CRD
  enabled: true

# Use emissary executor (recommended)
# Tag should match Argo Workflows version (chart 0.47.3 = app v3.7.x)
executor:
  image:
    registry: quay.io
    repository: argoproj/argoexec
    tag: v3.7.2

# RBAC configuration
createAggregateRoles: true

# Service account
workflow:
  serviceAccount:
    create: true
    name: argo-workflow

  rbac:
    create: true
