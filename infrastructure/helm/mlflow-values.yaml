# MLflow Helm Chart Values
# https://github.com/community-charts/helm-charts/tree/main/charts/mlflow

replicaCount: 1

image:
  repository: ghcr.io/mlflow/mlflow
  tag: "v3.6.0"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 5000

# Backend store configuration
backendStore:
  postgresql:
    enabled: true
    host: "postgresql"
    port: 5432
    database: "mlflow"
    user: "mlflow"
    # Password should be provided via secret
    existingSecret: "mlflow-postgres"
    existingSecretKey: "password"

# Artifact store configuration
artifactStore:
  s3:
    enabled: true
    bucket: "mlflow-artifacts"
    # Credentials via secret (or use IRSA in AWS)
    existingSecret: "mlflow-s3"
    accessKeyIdKey: "access-key"
    secretAccessKeyKey: "secret-key"

# Resource configuration
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

# Pod security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Probes
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5

# Ingress (optional - for external access)
ingress:
  enabled: false
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: mlflow.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: mlflow-tls
      hosts:
        - mlflow.example.com