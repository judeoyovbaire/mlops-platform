# Trivy ignore file for MLOps Platform
# https://aquasecurity.github.io/trivy/v0.28.0/docs/configuration/filtering/

# =============================================================================
# FIXED ISSUES (kept for reference)
# =============================================================================
# The following issues have been addressed in the codebase:
#
# AWS/EKS:
# - AVD-AWS-0104: EKS public endpoint disabled by default, CIDR restrictions when enabled
# - AVD-AWS-0057: VPC Flow Logs enabled via enable_vpc_flow_logs variable
# - AVD-AWS-0031: ECR image tags set to IMMUTABLE
# - AVD-AWS-0088: S3 state bucket now uses KMS CMK encryption
# - AVD-AWS-0132: Security group egress restricted to VPC CIDR for RDS
#
# Azure/AKS:
# - AVD-AZURE-0017: Key Vault network ACL defaults to Deny with VNet access
# - AVD-AZURE-0013: AKS API server supports authorized_ip_ranges
# - AVD-AZURE-0014: RBAC explicitly enabled on AKS clusters
#
# GCP/GKE:
# - AVD-GCP-0027: Default network creation disabled (auto_create_network = false)
# - AVD-GCP-0024: Cloud SQL SSL mode set to ENCRYPTED_ONLY

# =============================================================================
# Kubernetes manifest warnings - intentional for ML workloads
# =============================================================================
# KSV001: Process can elevate privileges - needed for GPU workloads
# KSV003: Default capabilities not dropped - handled by PodSecurityPolicy
# KSV012: Runs as root - some ML frameworks require this
# KSV014: Root filesystem not read-only - ML models need write access
# KSV021: Low user/group ID - acceptable for internal services

# =============================================================================
# External module warnings (terraform-aws-modules)
# =============================================================================
# These are from upstream Terraform registry modules and are configured
# via module inputs where possible. The following are accepted risks:
# - terraform-aws-modules/eks: Public endpoint access controlled via our variables
# - terraform-aws-modules/vpc: NAT Gateway egress is required for outbound traffic

# Ignore security group egress rules in external EKS module (node groups require outbound access)
# Path: terraform-aws-modules/eks/aws/node_groups.tf
aws-vpc-no-public-egress-sgr

# Ignore EKS public access warnings in external module (controlled via our cluster_endpoint_public_access variable)
# Path: terraform-aws-modules/eks/aws/main.tf
AVD-AWS-0040
AVD-AWS-0041

# Ignore GCP Cloud SQL SSL warning - ssl_mode=ENCRYPTED_ONLY enforces SSL but Trivy may not recognize it
# Path: infrastructure/terraform/modules/gke/storage.tf
AVD-GCP-0015

# Ignore AKS API Server IP ranges warning - configuration is intentionally flexible for dev
# Users should set api_server_authorized_ip_ranges for production
# Path: infrastructure/terraform/modules/aks/main.tf
AVD-AZU-0041

# =============================================================================
# Terraform module cache (third-party code)
# =============================================================================
# The .terraform directory contains downloaded modules from the Terraform registry.
# These are third-party modules with their own example files that may trigger warnings.
# Our actual infrastructure code is scanned; cached modules are excluded.
#
# NOTE: .trivyignore doesn't support directory patterns. Use --skip-dirs flag:
#   trivy config . --skip-dirs "**/.terraform"
#
# The CI/CD pipeline already uses this flag in the security-scan job.

# =============================================================================
# Development environment accepted risks
# =============================================================================
# The following are acceptable for dev environments but should be
# reviewed for production deployments:
# - RDS deletion protection disabled - enable via mlflow_db_deletion_protection=true
# - EKS public endpoint - disabled by default, enable with restricted CIDRs if needed
# - AKS API server IP ranges - empty by default, set specific CIDRs for production

# =============================================================================
# E2E Test Infrastructure (tests/e2e/minio.yaml)
# =============================================================================
# The MinIO manifest is used only for E2E testing in disposable Kind clusters.
# These are not production workloads and security hardening is not required.
# Path: tests/e2e/minio.yaml

# HIGH: Root filesystem not read-only - MinIO requires write access for data
KSV014

# HIGH: Default security context configured - acceptable for test workloads
KSV118

# MEDIUM: Runs as root - MinIO test container runs as root
KSV012

# MEDIUM: Container could be running as root user
KSV104

# MEDIUM: SYS_ADMIN capability added
KSV0125

# LOW: Various container security best practices not followed in test fixture
KSV011
KSV015
KSV016
KSV018
KSV020
KSV021
KSV030
KSV039
KSV040
KSV106